#include <stdint.h>

uint32_t * pABH2E = (uint32_t *)0x4002104c;
uint32_t * pAPB1E = (uint32_t *)0x40021058;
uint32_t * pGPOTR = (uint32_t *)0x48000404;
uint32_t * pGPPUP = (uint32_t *)0x4800040c;
uint32_t * pGPAFR = (uint32_t *)0x48000424;
uint32_t * pRCCCR = (uint32_t *)0x40021000;
uint32_t * pI2CCR1 = (uint32_t *)0x40005400;
uint32_t * pI2CTIM = (uint32_t *)0x40005410;
uint32_t * volatile pI2CISR = (uint32_t *)0x40005418;
uint32_t * volatile pI2CRXR = (uint32_t *)0x40005424;
uint32_t * volatile pI2CTXR = (uint32_t *)0x40005428;
uint32_t * pI2CCR2 = (uint32_t *)0x40005404;

typedef struct
{
	uint32_t mode0:2;
	uint32_t mode1:2;
	uint32_t mode2:2;
	uint32_t mode3:2;
	uint32_t mode4:2;
	uint32_t mode5:2;
	uint32_t mode6:2;
	uint32_t mode7:2;
	uint32_t mode8:2;
	uint32_t mode9:2;
	uint32_t mode10:2;
	uint32_t mode11:2;
	uint32_t mode12:2;
	uint32_t mode13:2;
	uint32_t mode14:2;
	uint32_t mode15:2;
}GPBMode;

int main()
{
	int16_t gxdata[2];
	int16_t gydata[2];
	int16_t gzdata[2];
	int16_t axdata[2];
	int16_t aydata[2];
	int16_t azdata[2];
	float g_x;
	float g_y;
	float g_z;
	float a_x;
	float a_y;
	float a_z;
	*pABH2E |= 0x02;
	*pAPB1E |= (0x01<<21);
	GPBMode * modecontroller = (GPBMode *)0x48000400;
	modecontroller->mode8 = 0x02;
	modecontroller->mode9 = 0x02;
	*pGPOTR |= (0x03<<8);
	*pGPPUP |= (0x05<<16);
	*pGPAFR |= 0x44;
	*pI2CCR2 |= (0x68<<1);
	*pI2CCR2 &= ~(0x01<<10);
	*pI2CCR2 |= (0x02<<16);
	*pI2CTIM |= (0x04<<20);
	*pI2CTIM |= (0x02<<16);
	*pI2CTIM |= 0x13;
	*pI2CTIM |= 0x01<<28;
	*pI2CTIM |= (0x0F<<8);
	*pI2CCR1 |= 0x01;
	*pI2CCR2 |= (0x01<<13);
	*pI2CTXR = 0x6B;
	while(!(*pI2CISR&(0x01)));
	*pI2CTXR = 0x0;
	while(!(*pI2CISR&(0x01)));
	*pI2CCR2 |= (0x01<<14);
	*pI2CCR2 &= ~(0xff<<16);
	*pI2CCR2 |= (0x01<<16);
	*pI2CCR2 |= (0x01<<13);
	*pI2CTXR = 0x1C;
	while(!(*pI2CISR&(0x01)));
	*pI2CCR2 |= (0x01<<14);
	*pI2CCR2 |= (0x01<<10);
	*pI2CCR2 |= (0x01<<13);
	while(!(*pI2CISR&(0x01<<2)));
	int8_t reg = *pI2CRXR;
	*pI2CCR2 |= (0x01<<14);
	while(1){
		*pI2CCR2 &= ~(0x01<<10);
		*pI2CCR2 |= (0x01<<13);
		*pI2CTXR = 0x44;
		while(!(*pI2CISR&(0x01)));
		*pI2CCR2 |= (0x01<<14);
		*pI2CCR2 |= (0x1<<10);
		*pI2CCR2 |= (0x1<<13);
		while(!(*pI2CISR&(0x01<<2)));
		gxdata[0] = *pI2CRXR;
		*pI2CCR2 |= (0x01<<14);
		*pI2CCR2 &= ~(0x01<<10);
		*pI2CCR2 |= (0x01<<13);
		*pI2CTXR = 0x43;
		while(!(*pI2CISR&(0x01)));
		*pI2CCR2 |= (0x01<<14);
		*pI2CCR2 |= (0x01<<10);
		*pI2CCR2 |= (0x01<<13);
		while(!(*pI2CISR&(0x01<<2)));
		gxdata[1] = *pI2CRXR;
		*pI2CCR2 |= 0x01<<14;
		*pI2CCR2 &= ~(0x01<<10);
		*pI2CCR2 |= (0x01<<13);
		*pI2CTXR |= 0x46;
		while(!(*pI2CISR&(0x01)));
		*pI2CCR2 |= (0x01<<14);
		*pI2CCR2 |= (0x01<<10);
		*pI2CCR2 |= (0x01<<13);
		while(!(*pI2CISR&(0x01<<2)));
		gydata[0] = *pI2CRXR;
		*pI2CCR2 |= (0x01<<14);
		*pI2CCR2 &= ~(0x01<<10);
		*pI2CCR2 |= (0x01<<13);
		*pI2CTXR = 0x45;
		while(!(*pI2CISR&(0x01)));
		*pI2CCR2 |= (0x01<<14);
		*pI2CCR2 |= (0x01<<10);
		*pI2CCR2 |= (0x01<<13);
		while(!(*pI2CISR&(0x01<<2)));
		gydata[1] = *pI2CRXR;
		*pI2CCR2 |= (0x01<<14);
		*pI2CCR2 &= ~(0x01<<10);
		*pI2CCR2 |= (0x01<<13);
		*pI2CTXR = 0x48;
		while(!(*pI2CISR&(0x01)));
		*pI2CCR2 |= (0x01<<14);
		*pI2CCR2 |= (0x01<<10);
		*pI2CCR2 |= (0x01<<13);
		while(!(*pI2CISR&(0x01<<2)));
		gzdata[0] = *pI2CRXR;
		*pI2CCR2 |= (0x01<<14);
		*pI2CCR2 &= ~(0x01<<10);
		*pI2CCR2 |= (0x01<<13);
		*pI2CTXR = 0x47;
		while(!(*pI2CISR&(0x01)));
		*pI2CCR2 |= (0x01<<14);
		*pI2CCR2 |= (0x01<<10);
		*pI2CCR2 |= (0x01<<13);
		while(!(*pI2CISR&(0x01<<2)));
		gzdata[1] = *pI2CRXR;
		*pI2CCR2 |= (0x01<<14);
		*pI2CCR2 &= ~(0x01<<10);
		*pI2CCR2 |= (0x01<<13);
		*pI2CTXR = 0x3C;
		while(!(*pI2CISR&(0x01)));
		*pI2CCR2 |= (0x01<<14);
		*pI2CCR2 |= (0x1<<10);
		*pI2CCR2 |= (0x1<<13);
		while(!(*pI2CISR&(0x01<<2)));
		axdata[0] = *pI2CRXR;
		*pI2CCR2 |= (0x01<<14);
		*pI2CCR2 &= ~(0x01<<10);
		*pI2CCR2 |= (0x01<<13);
		*pI2CTXR = 0x3B;
		while(!(*pI2CISR&(0x01)));
		*pI2CCR2 |= (0x01<<14);
		*pI2CCR2 |= (0x01<<10);
		*pI2CCR2 |= (0x01<<13);
		while(!(*pI2CISR&(0x01<<2)));
		axdata[1] = *pI2CRXR;
		*pI2CCR2 |= 0x01<<14;
		*pI2CCR2 &= ~(0x01<<10);
		*pI2CCR2 |= (0x01<<13);
		*pI2CTXR |= 0x3E;
		while(!(*pI2CISR&(0x01)));
		*pI2CCR2 |= (0x01<<14);
		*pI2CCR2 |= (0x01<<10);
		*pI2CCR2 |= (0x01<<13);
		while(!(*pI2CISR&(0x01<<2)));
		aydata[0] = *pI2CRXR;
		*pI2CCR2 |= (0x01<<14);
		*pI2CCR2 &= ~(0x01<<10);
		*pI2CCR2 |= (0x01<<13);
		*pI2CTXR = 0x3D;
		while(!(*pI2CISR&(0x01)));
		*pI2CCR2 |= (0x01<<14);
		*pI2CCR2 |= (0x01<<10);
		*pI2CCR2 |= (0x01<<13);
		while(!(*pI2CISR&(0x01<<2)));
		aydata[1] = *pI2CRXR;
		*pI2CCR2 |= (0x01<<14);
		*pI2CCR2 &= ~(0x01<<10);
		*pI2CCR2 |= (0x01<<13);
		*pI2CTXR = 0x40;
		while(!(*pI2CISR&(0x01)));
		*pI2CCR2 |= (0x01<<14);
		*pI2CCR2 |= (0x01<<10);
		*pI2CCR2 |= (0x01<<13);
		while(!(*pI2CISR&(0x01<<2)));
		azdata[0] = *pI2CRXR;
		*pI2CCR2 |= (0x01<<14);
		*pI2CCR2 &= ~(0x01<<10);
		*pI2CCR2 |= (0x01<<13);
		*pI2CTXR = 0x3F;
		while(!(*pI2CISR&(0x01)));
		*pI2CCR2 |= (0x01<<14);
		*pI2CCR2 |= (0x01<<10);
		*pI2CCR2 |= (0x01<<13);
		while(!(*pI2CISR&(0x01<<2)));
		azdata[1] = *pI2CRXR;
		*pI2CCR2 |= (0x01<<14);
		g_x = (gxdata[1]<<8|gxdata[0])/131.0;
		g_x = (g_x*3.14)/180;
		g_y = (gydata[1]<<8|gydata[0])/131.0;
		g_y = (g_y*3.14)/180;
		g_z = (gzdata[1]<<8|gzdata[0])/131.0;
		g_z = (g_z*3.14)/180;
		a_x = (axdata[1]<<8|axdata[0])/16384.0;
		a_x = (a_x)*9.81;
		a_y = (aydata[1]<<8|aydata[0])/16384.0;
		a_y = (a_y)*9.81;
		a_z = (azdata[1]<<8|azdata[0])/16384.0;
		a_z = (a_z)*9.81;
	}
}
